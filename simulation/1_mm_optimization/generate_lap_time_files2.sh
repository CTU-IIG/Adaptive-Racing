ls -1 | grep complex | { while read folder; do pushd "$folder"; rm -f lap_times.csv; ls -latrh | grep -o "example-[0-9]*" | sort | uniq | cut -d- -f2 | { while read seg; do find . -name "*-$seg-*-*log.lap_time" | sort | xargs -I'{}' bash -c "echo ' ' | cat '{}' -" | xargs echo "$seg" >> lap_times.csv; done }; cat lap_times.csv | cut -d' ' -f2- | perl -MList::Util=max -MList::Util=min -MList::Util=sum -lane 'printf "%f %f %f\n",min(@F), sum(@F)/@F, max(@F)' | paste -d' ' lap_times.csv - | tee lap_times.csv; ls -latrh | grep -o "example-[0-9]*" | sort | uniq | head -n 1 | { while read line; do ls -1 | grep -o "${line}-[0-9]*" | sort | uniq | wc -l; done } | xargs seq | tr '\n' ' ' | xargs -I'{}' sed -i "1i seg {}min avg max" lap_times.csv; mv lap_times.csv "$folder"_lap_times.csv; popd; done }
